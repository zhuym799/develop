<SUF7ScreenData>
   <Name>滚动文本进度 (安装期间)</Name>
   <Description>在一个滚动文本栏中显示安装进度。</Description>
   <GalleryVisiblity>16</GalleryVisiblity>
   <Screen>
      <Type>155</Type>
      <Name>滚动文本进度 (安装期间)</Name>
      <BannerStyle>2</BannerStyle>
      <TemplateName>滚动文本进度 (安装期间)</TemplateName>
      <OverrideProjTheme>0</OverrideProjTheme>
      <StyleData>
         <CstClrs>0</CstClrs>
         <TBBG format="hex">ffffff</TBBG>
         <BDYBG format="hex">ece9d8</BDYBG>
         <FTBG format="hex">ece9d8</FTBG>
         <TBTXT format="hex">000000</TBTXT>
         <BDYTXT format="hex">000000</BDYTXT>
         <CBG format="hex">ffffff</CBG>
         <C3DFACE format="hex">ece9d8</C3DFACE>
         <C3DHLT format="hex">ece9d8</C3DHLT>
         <C3DLIT format="hex">ffffff</C3DLIT>
         <C3DSH format="hex">aca899</C3DSH>
         <CBTNTXT format="hex">000000</CBTNTXT>
         <CTEXT format="hex">000000</CTEXT>
         <CDISTXT format="hex">aca899</CDISTXT>
         <CPRGRS format="hex">316ac5</CPRGRS>
         <C3DSHDK format="hex">716f64</C3DSHDK>
         <TBIMG>Default_Top_Banner.jpg</TBIMG>
         <SBIMG>Default_Side_Banner.jpg</SBIMG>
         <BDIMG/>
         <BDFILL>0</BDFILL>
         <HDSEP>1</HDSEP>
         <FTSEP>1</FTSEP>
         <CstFnts>0</CstFnts>
         <Fonts>
            <FontData>
               <FontName>Arial</FontName>
               <CharacterSet>0</CharacterSet>
               <Height>-13</Height>
               <Weight>700</Weight>
               <Italic>0</Italic>
               <Underline>0</Underline>
               <StrikeOut>0</StrikeOut>
               <AntiAlias>1</AntiAlias>
            </FontData>
            <FontData>
               <FontName>Arial</FontName>
               <CharacterSet>0</CharacterSet>
               <Height>-13</Height>
               <Weight>700</Weight>
               <Italic>0</Italic>
               <Underline>0</Underline>
               <StrikeOut>0</StrikeOut>
               <AntiAlias>1</AntiAlias>
            </FontData>
            <FontData>
               <FontName>Arial</FontName>
               <CharacterSet>0</CharacterSet>
               <Height>-24</Height>
               <Weight>700</Weight>
               <Italic>0</Italic>
               <Underline>0</Underline>
               <StrikeOut>0</StrikeOut>
               <AntiAlias>1</AntiAlias>
            </FontData>
            <FontData>
               <FontName>Arial</FontName>
               <CharacterSet>0</CharacterSet>
               <Height>-13</Height>
               <Weight>400</Weight>
               <Italic>0</Italic>
               <Underline>0</Underline>
               <StrikeOut>0</StrikeOut>
               <AntiAlias>1</AntiAlias>
            </FontData>
            <FontData>
               <FontName>Arial</FontName>
               <CharacterSet>0</CharacterSet>
               <Height>-13</Height>
               <Weight>400</Weight>
               <Italic>0</Italic>
               <Underline>0</Underline>
               <StrikeOut>0</StrikeOut>
               <AntiAlias>1</AntiAlias>
            </FontData>
         </Fonts>
         <CAOff>
            <TP>0</TP>
            <L>15</L>
            <T>15</T>
            <R>15</R>
            <B>15</B>
         </CAOff>
         <CAOff>
            <TP>1</TP>
            <L>15</L>
            <T>15</T>
            <R>15</R>
            <B>15</B>
         </CAOff>
         <CAOff>
            <TP>2</TP>
            <L>15</L>
            <T>15</T>
            <R>15</R>
            <B>15</B>
         </CAOff>
      </StyleData>
      <IsWhileInstallingMode>1</IsWhileInstallingMode>
      <Events>
         <Event>
            <Name>On Preload</Name>
            <Args/>
            <Script>-- 这些操作在屏幕显示之前执行。
</Script>
         </Event>
         <Event>
            <Name>On Progress</Name>
            <Args>number e_Stage, string e_CurrentItemText, number e_CurrentItemPct, number e_StagePct</Args>
            <Script>-- 这些操作在安装文件时执行。

--[[
注意：
	文件安装进度分为 4 个安装阶段：

	1. 准备安装
	2. 正在安装文件
	3. 正在创建卸载
	4. 正在创建快捷方式

	每个进度阶段在工程的语言文件中都有一个字符串来进行描述，
	如：“正在安装文件...”。这让进度文本的翻译编程可能（连同
	语言文件中的其他本地化字符串一起)。
]]

-- 为当前阶段的进度信息获取适当的字符串 ID...
local strStringID;
if(e_Stage == INSTALL_STAGE_PREPARING) then
	strStringID = "MSG_PROG_PREPARING";
elseif(e_Stage == INSTALL_STAGE_INSTALLING_FILES) then
	strStringID = "MSG_PROG_INSTALLING_FILES";
elseif(e_Stage == INSTALL_STAGE_CREATING_UNINSTALL) then
	strStringID = "MSG_PROG_CREATING_UNINSTALL";
elseif(e_Stage == INSTALL_STAGE_CREATING_SHORTCUTS) then
	strStringID = "MSG_PROG_CREATING_SHORTCUTS";
end

-- ...并从语言文件中获取相应的字符串
local strStageMessage = SetupData.GetLocalizedString(strStringID);

-- 如果阶段已更改，则将其进度信息追加到滚动文本栏
if(nLastStage ~= e_Stage) then
	-- 如果进度信息不为空，则追加
	if(strStageMessage ~= "") then
		DlgScrollingText.AppendLine(CTRL_SCROLLTEXT_BODY, strStageMessage);
	end
end

-- 如果当前项目已更改，则将其进度信息追加到滚动文本栏
if(strLastProgressItem ~= e_CurrentItemText) then
	-- 如果进度信息不为空，则追加
	if(e_CurrentItemText ~= "") then
		-- 如果当前项目是一个文件路径，它对于屏幕来说可能太长...
		-- 下一步操作将缩短文本为 72 个字符 (如果它至少包含一个 \)
		local strAbbreviatedItemText = String.AbbreviateFilePath(e_CurrentItemText, 72);

		DlgScrollingText.AppendLine(CTRL_SCROLLTEXT_BODY, strAbbreviatedItemText);
	end
end

-- 记住当前阶段和项目
nLastStage = e_Stage;
strLastProgressItem = e_CurrentItemText;
</Script>
         </Event>
         <Event>
            <Name>On Cancel</Name>
            <Args/>
            <Script>-- 这些操作在点击“取消”按钮时执行。

-- 来自 _SUF70_Global_Functions.lua:
-- 询问用户是否确定要退出
if g_ConfirmSetupAbort() then
	Application.Exit();
end
</Script>
         </Event>
      </Events>
      <Controls>
         <Control>
            <Type>1</Type>
            <ID>102</ID>
            <Visible>1</Visible>
            <Enabled>1</Enabled>
            <TabOrder>78</TabOrder>
            <FTButton>1</FTButton>
         </Control>
         <Control>
            <Type>2</Type>
            <ID>203</ID>
            <Visible>1</Visible>
            <Enabled>1</Enabled>
            <TabOrder>1</TabOrder>
            <IsHeading>0</IsHeading>
         </Control>
         <Control>
            <Type>2</Type>
            <ID>204</ID>
            <Visible>1</Visible>
            <Enabled>1</Enabled>
            <TabOrder>3</TabOrder>
            <IsHeading>0</IsHeading>
         </Control>
         <Control>
            <Type>3</Type>
            <ID>400</ID>
            <Visible>1</Visible>
            <Enabled>1</Enabled>
            <TabOrder>2</TabOrder>
            <IsHTML>0</IsHTML>
            <TextAlign>0</TextAlign>
            <VertScroll>1</VertScroll>
            <HorizScroll>0</HorizScroll>
            <RTLReadingOrder>0</RTLReadingOrder>
            <Style>1</Style>
            <ReadOnly>1</ReadOnly>
            <SpecifyType>1</SpecifyType>
            <FilePath/>
            <Variable/>
         </Control>
      </Controls>
   </Screen>
</SUF7ScreenData>
